<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Campus Lost & Found</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="dashboard-header">
        <nav class="dashboard-nav">
            <div class="dashboard-logo">Campus Lost & Found</div>
            <div class="dashboard-menu">
                <span id="userName"></span>
                <a href="report-lost.html">Report Lost</a>
                <a href="report-found.html">Report Found</a>
                <a href="search.html">Search</a>
                <a href="index.html">Home</a>
                <button onclick="logout()">Logout</button>
            </div>
        </nav>
    </header>

    <div class="dashboard-container">
        <div class="dashboard-section">
            <h2>My Items</h2>
            <div class="items-grid" id="myItemsGrid"></div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        if (!requireAuth()) {
            throw new Error('Authentication required');
        }

        const user = getUser();
        document.getElementById('userName').textContent = `Welcome, ${user.name}`;

        async function loadMyItems() {
            try {
                const response = await apiCall('/items/user/my-items');
                const data = await response.json();
                const grid = document.getElementById('myItemsGrid');

                if (data.items && data.items.length > 0) {
                    grid.innerHTML = data.items.map(item => `
                        <div class="item-card-full">
                            ${item.image ? `<img src="${item.image}" alt="${item.title}">` : `<div style="height: 200px; background: #ddd; border-radius: 4px; display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">No Image</div>`}
                            <h3>${item.title}</h3>
                            <p class="item-meta">
                                <span class="badge badge-${item.status}">${item.status.toUpperCase()}</span>
                                <strong>${item.type.toUpperCase()}</strong> • ${item.category}
                            </p>
                            <p class="item-meta">${item.location} • ${formatDate(item.date)}</p>
                            <p>${item.description}</p>
                            <div class="item-actions">
                                <button class="btn btn-danger btn-sm" onclick="deleteItem('${item.id}')">Delete</button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    grid.innerHTML = '<div class="no-data">You haven\'t reported any items yet.<br><a href="report-lost.html">Report Lost Item</a> or <a href="report-found.html">Report Found Item</a></div>';
                }
            } catch (error) {
                console.error('Error loading items:', error);
            }
        }

        async function deleteItem(itemId) {
            if (!confirm('Are you sure you want to delete this item?')) return;

            try {
                const response = await apiCall(`/items/${itemId}`, { method: 'DELETE' });
                if (response.ok) {
                    alert('Item deleted successfully');
                    loadMyItems();
                } else {
                    alert('Failed to delete item');
                }
            } catch (error) {
                console.error('Error deleting item:', error);
                alert('An error occurred');
            }
        }

        loadMyItems();
    </script>
</body>
</html>
