<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Lost Item - Campus Lost & Found</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="dashboard-header">
        <nav class="dashboard-nav">
            <div class="dashboard-logo">Campus Lost & Found</div>
            <div class="dashboard-menu">
                <a href="dashboard.html">Dashboard</a>
                <a href="search.html">Search</a>
                <a href="index.html">Home</a>
            </div>
        </nav>
    </header>

    <div class="dashboard-container">
        <div class="dashboard-section" style="max-width: 600px; margin: 2rem auto;">
            <h2>Report Lost Item</h2>
            <form id="reportForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="title">Item Title *</label>
                    <input type="text" id="title" required placeholder="e.g., Black Backpack">
                </div>

                <div class="form-group">
                    <label for="description">Description *</label>
                    <textarea id="description" required placeholder="Provide detailed description..."></textarea>
                </div>

                <div class="form-group">
                    <label for="category">Category *</label>
                    <select id="category" required>
                        <option value="">Select Category</option>
                        <option value="electronics">Electronics</option>
                        <option value="clothing">Clothing</option>
                        <option value="books">Books</option>
                        <option value="keys">Keys</option>
                        <option value="accessories">Accessories</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="location">Location Lost *</label>
                    <input type="text" id="location" required placeholder="e.g., Library 2nd Floor">
                </div>

                <div class="form-group">
                    <label for="date">Date Lost *</label>
                    <input type="date" id="date" required>
                </div>

                <div class="form-group">
                    <label for="contactInfo">Contact Info</label>
                    <input type="text" id="contactInfo" placeholder="Optional: Phone or email">
                </div>

                <div class="form-group">
                    <label for="image">Upload Image</label>
                    <input type="file" id="image" accept="image/*">
                </div>

                <div id="message" style="display: none; margin-bottom: 1rem;"></div>

                <button type="submit" class="btn btn-secondary btn-full">Report Lost Item</button>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        if (!requireAuth()) throw new Error('Authentication required');

        document.getElementById('date').valueAsDate = new Date();

        document.getElementById('reportForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData();
            formData.append('title', document.getElementById('title').value);
            formData.append('description', document.getElementById('description').value);
            formData.append('category', document.getElementById('category').value);
            formData.append('location', document.getElementById('location').value);
            formData.append('date', document.getElementById('date').value);
            formData.append('contactInfo', document.getElementById('contactInfo').value);
            formData.append('type', 'lost');

            const imageFile = document.getElementById('image').files[0];
            if (imageFile) {
                formData.append('image', imageFile);
            }

            const messageDiv = document.getElementById('message');

            try {
                const response = await apiCall('/items', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    messageDiv.className = 'success-message';
                    messageDiv.textContent = 'Item reported successfully!';
                    messageDiv.style.display = 'block';
                    setTimeout(() => window.location.href = 'dashboard.html', 2000);
                } else {
                    messageDiv.className = 'error-message';
                    messageDiv.textContent = data.error || 'Failed to report item';
                    messageDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('Error:', error);
                messageDiv.className = 'error-message';
                messageDiv.textContent = 'An error occurred. Please try again.';
                messageDiv.style.display = 'block';
            }
        });
    </script>
</body>
</html>
